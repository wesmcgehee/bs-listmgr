/*
 *
 * Wijmo Library 1.2.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(b){"use strict";var a="wijmo-wijprogressbar",j="ui-progressbar",i=j+"-label",c=a+"-lb-",d="ui-corner-",g=d+"left",f=d+"right",h=d+"top",e=d+"bottom";b.widget("wijmo.wijprogressbar",b.ui.progressbar,{options:{labelAlign:"center",maxValue:100,minValue:0,fillDirection:"east",labelFormatString:"{1}%",toolTipFormatString:"{1}%",indicatorIncrement:1,indicatorImage:"",animationDelay:0,animationOptions:{disabled:false,easing:null,duration:500},progressChanging:null,beforeProgressChanging:null,progressChanged:null},_setOption:function(c,d){var a=this,e=a.options,f;switch(c){case"value":e[c]=parseInt(d,10);a._refreshValue();return;case"maxValue":case"minValue":f=parseInt(d,10);e[c]=f;a[c==="maxValue"?"max":"min"]=f;a._refreshValue();return;case"labelFormatString":case"toolTipFormatString":e[c]=d;a._refreshValue();return;case"fillDirection":case"labelAlign":case"indicatorImage":e[c]=d;a._updateElementsCss();return}b.Widget.prototype._setOption.apply(a,arguments)},_create:function(){var c=this,e=c.options,d=c.element;c.directions={east:"left",west:"right",north:"bottom",south:"top"};c.min=e.minValue;c.max=e.maxValue;d.addClass(a);b.ui.progressbar.prototype._create.apply(c,arguments);c.label=b("<span>").addClass(i).appendTo(d);c._updateElementsCss();c._isInit=true;c._refreshValue()},_triggerEvent:function(a,c,b){return this._trigger(a,null,{oldValue:c,newValue:b})===false},_refreshValue:function(){var a=this,g=a.options,f=g.animationOptions,h=a.element,c,e,d;if(!a._isInit)return;d=h.attr("aria-valuenow");c=a.value();e=(c-a.min)/(a.max-a.min)*100;if(a._triggerEvent("beforeProgressChanging",d,c))return;if(!f.disabled&&f.duration>0)setTimeout(function(){b.wijmo.wijprogressbar.animations.progress({content:a.valueDiv,complete:function(){a._triggerEvent("progressChanged",d,c)},step:function(b){a._performAnimating(b)},progressValue:e},f)},g.animationDelay);else{a._refreshProgress(Math.round(e));a._lastStep=e;a._triggerEvent("progressChanged",d,c)}},_refreshProgress:function(c){var a=this,d=a.options,i=d.fillDirection,j=a.element,b=c*(a.max-a.min)/100+a.min;if(a._triggerEvent("progressChanging",j.attr("aria-valuenow"),b))return;if(a._isHorizontal())a.valueDiv.toggleClass(i==="east"?f:g,b===a.max).width(c+"%");else a.valueDiv.toggleClass(i==="south"?e:h,b===a.max).height(c+"%");a.label.html(a._getFormatString(d.labelFormatString,c,b));j.attr("aria-valuenow",b).attr("title",a._getFormatString(d.toolTipFormatString,c,b))},_isHorizontal:function(){var a=this.options.fillDirection;return a==="west"||a==="east"},_getRotateTextOffset:function(a){var c,b;a.css("width","auto");c=a.outerWidth();b=a.outerHeight();a.css("width","");return Math.max(c-b-4,0)},_updateElementsCss:function(){var b=this,e=b.options,d=b.element,c=e.fillDirection;d.removeClass(a+"-west "+a+"-east "+a+"-north "+a+"-south").addClass(a+"-"+c);b._updateProgressCss();b._updateLabelCss()},_updateLabelCss:function(){var d=this,i=d.options,h=d.element,a=i.labelAlign,e=d.label,g=d._lastStep,f=h.height();e.removeClass(c+"west "+c+"east "+c+"south "+c+"north "+c+"center "+c+"running").addClass(c+a).css({left:"",right:"",top:"",bottom:"",width:"","text-align":"","line-height":""});a!=="north"&&a!=="south"&&!(a==="running"&&!d._isHorizontal())&&e.css("line-height",f+"px");if(a==="running")d._updateRunningLabelCss(g);else if(!d._isHorizontal()&&!b.browser.msie)if(a==="north")e.css("width","100%").css("line-height",f+"px").css("text-align","right");else a==="south"&&e.css("width","100%").css("line-height",f+"px").css("text-align","left")},_updateRunningLabelCss:function(l){var a=this,m=a.options,i=m.fillDirection,k=a.element,f=a.label,j=a.valueDiv,e=a._isHorizontal(),c,d,g,h;c=k[e?"width":"height"]();d=f[e?"outerWidth":"outerHeight"]();g=j[e?"outerWidth":"outerHeight"]();if(!e&&!b.browser.msie)d+=a._getRotateTextOffset(f);h=c===g?c-d:l*c/100-d+d*(c-g)/c;f.css(a.directions[i],h)},_updateProgressCss:function(){var b=this,j=b.options,k=j.fillDirection,i=j.indicatorImage,a=b.valueDiv,c=b._lastStep;i!==""&&a.css("background","transparent url("+i+") repeat fixed");a.removeClass(g+" "+f+" "+h+" "+e).addClass(d+b.directions[k]);if(c)if(b._isHorizontal())a.css("width",c+"%").css("height","");else a.css("height",c+"%").css("width","");else a.css({width:"",height:""})},_performAnimating:function(a){var b=this,d=b.options,c=d.indicatorIncrement;if(c!==1)a=Math.floor(a/c)*c;else a=Math.round(a);if(b._lastStep===a)return;b._lastStep=a;b._refreshProgress(a);d.labelAlign==="running"&&b._updateRunningLabelCss(a)},_getFormatString:function(a,d,e){var c=this,g=c.max-e,f=100-d,b=/\{0\}/g;a=a.replace(b,e.toString());b=/\{ProgressValue\}/g;a=a.replace(b,e.toString());b=/\{1\}/g;a=a.replace(b,d.toString());b=/\{PercentProgress\}/g;a=a.replace(b,d.toString());b=/\{2\}/g;a=a.replace(b,g.toString());b=/\{RemainingProgress\}/g;a=a.replace(b,g.toString());b=/\{3\}/g;a=a.replace(b,f.toString());b=/\{PercentageRemaining\}/g;a=a.replace(b,f.toString());b=/\{4\}/g;a=a.replace(b,c.min);b=/\{Min\}/g;a=a.replace(b,c.min);b=/\{5\}/g;a=a.replace(b,c.max);b=/\{Max\}/g;a=a.replace(b,c.max);return a},destroy:function(){var d=this,c=d.element;c.empty().attr("aria-valuemax","").attr("aria-valuemin","").attr("aria-valuenow","").attr("title","").attr("role","").removeClass(a+" "+a+"-east "+a+"-west "+a+"-north "+a+"-south");b.Widget.prototype.destroy.apply(this,arguments)}});b.extend(b.wijmo.wijprogressbar,{animations:{progress:function(a,c){a=b.extend({easing:"swing",duration:1e3},a,c);a.content.stop(true,true).animate({pgvalue:a.progressValue},a)}}})})(jQuery);